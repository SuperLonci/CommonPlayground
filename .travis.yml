stages:
  - build-backend
  - build-frontend
  - test-backend
  - test-frontend
  - deploy-backend
  - deploy-frontend

jobs:
  include:
    - stage: build-backend
      language: java
      script:
        - (cd backend/; ./gradlew assemble)
    - stage: build-frontend
      language: android
      android:
        components:
          - build-tools-28.0.3
          - android-28
      script:
        - (cd frontend/; ./gradlew assembleDebug)

    - stage: test-backend
      language: java
      script:
        - (cd backend/; ./gradlew clean test)
    - stage: test-frontend
      language: android
      android:
        components:
          - build-tools-28.0.3
          - android-28
      before_script:
        - cd frontend/
        - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a -c 100M
        - emulator -avd test -no-audio -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
      script:
        - (cd frontend/; ./gradlew build connectedCheck)

    - stage: deploy-backend
      if: branch = master
      language: java
      script:
        - echo "Deployment-Backend"
    - stage: deploy-frontend
      if: branch = master
      language: android
      android:
        components:
          - build-tools-28.0.3
          - android-28
      script:
        - echo "Deployment-Frontend"
